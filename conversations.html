<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conversations - Design Canvas</title>
    
    <!-- Favicon for dark mode only -->
    <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon/favicon-dark.png">
    <link rel="icon" type="image/png" sizes="64x64" href="./assets/images/favicon/favicon-dark@2x.png">
    <link rel="icon" type="image/png" sizes="128x128" href="./assets/images/favicon/favicon-dark@4x.png">
    
    <!-- Fallback favicon -->
    <link rel="icon" type="image/png" href="./assets/images/favicon/favicon-dark.png">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Force dark mode for conversations view */
        :root {
            /* Dark mode color variables */
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #262626;
            --bg-quaternary: #333333;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-tertiary: #999999;
            --text-quaternary: #666666;
            --border-primary: #333333;
            --border-secondary: #404040;
            --accent-primary: #3b82f6;
            --accent-secondary: #10b981;
            --shadow-primary: rgba(0, 0, 0, 0.3);
            --shadow-secondary: rgba(0, 0, 0, 0.1);
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
        }
    </style>
    <script>
    window.AGENT_CFG = {
    CHAT_URL: 'https://iiolvvdnzrfcffudwocp.functions.supabase.co/llm-proxy-auth',
    SUPABASE_URL: 'https://iiolvvdnzrfcffudwocp.supabase.co',
    SUPABASE_ANON: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imlpb2x2dmRuenJmY2ZmdWR3b2NwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MjE4MDAsImV4cCI6MjA3MzA5NzgwMH0.2-e8Scn26fqsR11h-g4avH8MWybwLTtcf3fCN9qAgVw'
    };
    </script>
    <!-- Optional local override; guard 404 on Pages -->
    <script>
    (function(){
      var s = document.createElement('script');
      s.src = 'env.local.js';
      s.defer = true;
      s.onerror = function(){ console.info('env.local.js not found (ok on Pages)'); };
      document.currentScript.parentNode.insertBefore(s, document.currentScript.nextSibling);
    })();
    </script>
    <!-- Supabase client for auth (Browser UMD build) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.47.10/dist/umd/supabase.js"></script>
</head>
<body>
    <!-- Main Container -->
    <div class="conversations-container">
        <!-- Header -->
        <header class="conversations-header">
            <!-- Logo -->
            <div class="conversations-logo">
                <img src="./assets/images/SuperLogo.png" alt="SUPER" class="logo-img" />
            </div>
            
            <!-- User Account Component -->
            <div class="user-account-component">
                <!-- Connection Status Indicator -->
                <div class="connection-status" id="connectionStatus" title="Connected">
                    <div class="status-dot"></div>
                </div>
                
                <!-- User Account Section -->
                <div class="user-account-section" id="userAccountSection">
                    <!-- Auth State: Not Signed In -->
                    <div class="auth-state" id="authStateSignedOut">
                        <input id="authEmail" type="email" placeholder="enter@your.email" class="auth-email-input" />
                        <button id="signInBtn" class="IconButton-Wrapper" title="Sign in">
                            <img src="./assets/images/icons/icon-send.png" alt="Send" class="auth-icon-img" />
                        </button>
                    </div>
                    
                    <!-- Auth State: Signed In -->
                    <div class="auth-state hidden" id="authStateSignedIn">
                        <span class="user-email" id="userEmailDisplay"></span>
                        <button id="signOutBtn" class="IconButton-Wrapper">
                            <img src="./assets/images/icons/icon-logout.png" alt="LogOut" class="auth-icon-img" />
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="conversations-main">
            <!-- Title -->
            <h1 class="conversations-title">What are you working on today?</h1>
            
            <!-- Conversations List Container -->
            <div class="conversations-list-container">
                <div class="conversations-list-card">
                    <div class="conversations-list-header">
                        <h2 class="conversations-list-title">Your Conversations</h2>
                    </div>
                    
                    <div class="conversations-list-content" id="conversationsListContent">
                        <div class="conversations-loading">
                            <div class="loading-text">Loading conversations...</div>
                        </div>
                    </div>
                    
                    <!-- New Conversation Input -->
                    <div class="new-conversation-input-container">
                        <div class="new-conversation-input-wrapper">
                            <button class="conversation-image-btn" id="conversationImageBtn" title="Upload image">
                                <img src="./assets/images/icons/icon-img.png" alt="Image" class="auth-icon-img" />
                            </button>
                            <input type="text" id="newConversationInput" class="new-conversation-input" placeholder="Something new" />
                            <button class="conversation-send-btn" id="newConversationSendBtn" title="Start conversation">
                                <img src="./assets/images/icons/icon-send.png" alt="Send" class="auth-icon-img" />
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="conversations.js"></script>
    <script>
        // Check authentication state on page load
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                if (!window.__SB_CLIENT__) {
                    window.__SB_CLIENT__ = window.supabase.createClient(
                        window.AGENT_CFG.SUPABASE_URL,
                        window.AGENT_CFG.SUPABASE_ANON,
                        { auth: { storageKey: 'sb-design-context-auth' } }
                    );
                }
                const supabase = window.__SB_CLIENT__;
                const { data: { session } } = await supabase.auth.getSession();
                if (!session || !session.user) {
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Error checking auth state:', error);
                window.location.href = 'login.html';
            }
        });
    </script>
</body>
</html>
